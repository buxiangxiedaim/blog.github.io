{"meta":{"title":"å¼€å¡éœ²åŠ å†°çš„åšå®¢","subtitle":"","description":"","author":"å¼ å°¹","url":"https://kaisailu-with-ice.gitee.io/blog","root":"/blog/"},"pages":[],"posts":[{"title":"å›¾ç‰‡é¢„åŠ è½½","slug":"å›¾ç‰‡é¢„åŠ è½½","date":"2022-12-05T07:58:25.803Z","updated":"2022-12-05T08:05:55.759Z","comments":true,"path":"2022/12/05/å›¾ç‰‡é¢„åŠ è½½/","link":"","permalink":"https://kaisailu-with-ice.gitee.io/blog/2022/12/05/%E5%9B%BE%E7%89%87%E9%A2%84%E5%8A%A0%E8%BD%BD/","excerpt":"","text":"åœ¨åˆ¶ä½œä¸ªäººç½‘é¡µæ—¶é‡åˆ°äº†ä¸€ä¸ªéœ€æ±‚ã€‚ç”±äºç½‘ç«™å†…é™æ€èµ„æºå›¾ç‰‡æ¯”è¾ƒå¤šï¼Œè‹¥æŒ‰ç…§æ™®é€šåŠ è½½æ–¹å¼ï¼Œå½“ç½‘é€Ÿä¸æ˜¯éå¸¸å¿«æ—¶ä¼šå‡ºç°å·²ç»è¿›å…¥ç½‘ç«™ï¼Œä½†å›¾ç‰‡è¿˜åœ¨åŠ è½½çš„æƒ…å†µ å®¢æˆ·ç«¯ä¸»è¦ä»£ç å®¢æˆ·ç«¯æœ€åŸºç¡€çš„ä¸¤ä¸ªåŠŸèƒ½ï¼šä½¿ç”¨socket.emit()å‘é€å‘½ä»¤ï¼Œsocket.on()æ¥æ”¶æ•°æ® 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051import React, { useState, useEffect, useRef } from 'react';import io from 'socket.io-client';const socket = io(window._CONFIG[\"socketUrl\"]);const Home = () =&gt; { const [userInfo, setUserInfo] = useState({city:'',ip:''}) const [inputVal, setInputVal] = useState('') //inputè¾“å…¥å€¼ const [msgList, setMsgList ] = useState([]) //æ¶ˆæ¯åˆ—è¡¨ useEffect(() =&gt; { // console.log(inputRef.current); socket.on('info', (data) =&gt; { //å•æ¡ä¿¡æ¯äº‹ä»¶ setMsgList([...msgList,data]) }); socket.on('response_msg', (data) =&gt; { //å†å²ä¿¡æ¯äº‹ä»¶ setMsgList([...data]) }); }, [msgList]); // è·å–å†å²æ¶ˆæ¯ const getHistoryMsg = () =&gt; { socket.emit('getHistory', 'ç‚¹å‡»è·å–å†å²è®°å½•') } // æäº¤æ¶ˆæ¯ const submit = useThrottle(() =&gt; { const newVal = inputVal.trim() if(!newVal){ return message.info('æ¶ˆæ¯ä¸å¯ä¸ºç©º') } let params = { id:new Date().getTime(), date: new Date().toLocaleDateString() + ' ' + new Date().toLocaleTimeString(), message: inputVal, } socket.emit('submit', params) },1000) // é”®ç›˜äº‹ä»¶ const inputKeyDown = (e) =&gt; { // å½“æŒ‰ä¸‹å›è½¦é”® if(e.keyCode === 13){ e.preventDefault(); submit() } }};export default Home; åå°ä¸»è¦ä»£ç åå°å½“å®¢æˆ·ç«¯è¿æ¥æˆåŠŸåï¼Œå¯¹ä¸¤ä¸ªäº‹ä»¶è¿›è¡Œç›‘å¬ï¼Œå¹¶ä½œå‡ºç›¸åº”æ“ä½œã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940const app = require('express')();const http = require('http').Server(app);//è¿™é‡Œå¿…é¡»ç»‘å®šåœ¨httpå®ä¾‹ä¸Šè€Œä¸æ˜¯appä¸Šconst io = require('socket.io')(http, { cors: true }); //1.è§£å†³è·¨åŸŸconst mysql = require('mysql');const db = mysql.createPool({ host : 'localhost', user : 'root', password : '123456', database : 'demo'});io.on('connection', function (socket) { // å½“å®¢æˆ·ç«¯æäº¤æ¶ˆæ¯ socket.on('submit', function (data){ // å°†æ”¶åˆ°çš„æ¶ˆæ¯å‘ç»™å®¢æˆ·ç«¯ io.emit('info', data) // å°†æ”¶åˆ°çš„æ¶ˆæ¯æ’å…¥æ•°æ®åº“ const { date, message } = data db.query('INSERT INTO chats (date, message) VALUES (?, ?)',[date, message], (err, res) =&gt; { if (err) throw err; console.log('æ•°æ®æ’å…¥æˆåŠŸï¼'); }) }); // å½“å®¢æˆ·ç«¯è¯·æ±‚å†å²æ¶ˆæ¯ socket.on('getHistory', function (data){ db.query('SELECT * FROM chats', function (error, results, fields) { if (error) throw error; let result = JSON.parse(JSON.stringify(results)) // å°†æŸ¥è¯¢åˆ°çš„æ¶ˆæ¯å‘é€ç»™å®¢æˆ·ç«¯ socket.emit('response_msg',result) }); })});http.listen(9000, () =&gt; { console.log('ç›‘å¬ç«¯å£:9000');}); å®¢æˆ·ç«¯å’Œåç«¯ä¾èµ–ä¸åŒå®¢æˆ·ç«¯ä½¿ç”¨çš„æ˜¯socket.io-clientï¼Œè€Œåå°ä½¿ç”¨çš„æ˜¯socket.io 12npm install socket.io-client //å‰å°ä¾èµ–npm install socket.io //åå°ä¾èµ– åŒæ­¥åœ¨çº¿äººæ•°åŠŸèƒ½ä»£ç åŒæ­¥åœ¨çº¿äººæ•°ä¸»è¦çš„å®ç°æ€è·¯æ˜¯ï¼Œåå°å£°æ˜ä¸€ä¸ªå˜é‡numï¼Œå½“è¿æ¥æˆåŠŸæ—¶+1ï¼Œæ–­å¼€è¿æ¥æ—¶-1ï¼Œå¹¶å°†å˜é‡å‘é€ç»™å®¢æˆ·ç«¯ 1234567891011121314let num = 0io.on('connection', function (socket) { num++ console.log('å·²è¿æ¥'); io.emit('num_change', num) // è¿æ¥å·²æ–­å¼€ socket.on('disconnect', () =&gt; { num-- io.emit('num_change', num) console.log('è¿æ¥å·²æ–­å¼€...') });}); å®˜æ–¹æ–‡æ¡£ä¸­æ˜¯æœ‰socket.on(â€˜disconnectâ€™, () =&gt; {})äº‹ä»¶ç›‘å¬çš„ï¼Œä½†æ˜¯æˆ‘è¿™é‡Œä½¿ç”¨å§‹ç»ˆä¸ç”Ÿæ•ˆã€‚ è·å–ç”¨æˆ·ipå±åœ°åŠŸèƒ½ä»£ç ä¸»è¦ä½¿ç”¨http://pv.sohu.com/cityjson?ie=utf-8 è¿™ä¸ªapi 1234567891011121314151617181920212223// é¦–å…ˆåœ¨proxyä¸­é…ç½®ä»£ç†'/apiSohu': { target: 'http://pv.sohu.com', // localhost=&gt;target changeOrigin: true, pathRewrite: { '^/apiSohu/': '/' }}// å…¶æ¬¡ä½¿ç”¨axiosè¿›è¡Œè¯·æ±‚userCity: `${apiSohu}/cityjson?ie=utf-8`async getUserInfo(data){ const response = await this.$http({ url : userCity, method: \"get\", data, }) return this.$handleResponse(response)}useEffect(() =&gt; { getUserInfo()},[]) æ¶ˆæ¯é¢œè‰²åŠŸèƒ½ä»£ç å–è‰²å™¨åŠŸèƒ½ç›¸å¯¹åå°æ¯”è¾ƒç®€å•ï¼Œåªæ˜¯å¢åŠ äº†ä¸€ä¸ªcolorå­—æ®µè€Œå·²ã€‚é‡ç‚¹åœ¨äºHTML5è‡ªå¸¦å–è‰²å™¨ï¼Œä¹‹å‰ç¡®å®ä¸æ¸…æ¥šã€‚ 1234567const [color, setColor] = useState('')const colorChange = e =&gt; { setColor(e.target.value)}&lt;input type=\"color\" value={color} onChange={colorChange}/&gt;","categories":[{"name":"my_project\n- æ–‡ç« åˆ†ç±»","slug":"my-project-æ–‡ç« åˆ†ç±»","permalink":"https://kaisailu-with-ice.gitee.io/blog/categories/my-project-%E6%96%87%E7%AB%A0%E5%88%86%E7%B1%BB/"}],"tags":[{"name":"JavaScript","slug":"JavaScript","permalink":"https://kaisailu-with-ice.gitee.io/blog/tags/JavaScript/"}]},{"title":"Socket.IOå®ç°èŠå¤©å®¤","slug":"readme","date":"2022-11-11T01:28:38.828Z","updated":"2022-11-11T01:43:07.810Z","comments":true,"path":"2022/11/11/readme/","link":"","permalink":"https://kaisailu-with-ice.gitee.io/blog/2022/11/11/readme/","excerpt":"","text":"å­¦ä¹ Socket.IOçš„è¿‡ç¨‹ä¸­åˆ¶ä½œäº†ä¸€ä¸ªå®æ—¶èŠå¤©å®¤demoï¼Œæœ¬æ–‡è®°å½•ä¸€ä¸‹ä¸»è¦å®ç°ä»£ç å’Œä¸»è¦åŠŸèƒ½é‡åˆ°çš„å›°éš¾ å®¢æˆ·ç«¯ä¸»è¦ä»£ç å®¢æˆ·ç«¯æœ€åŸºç¡€çš„ä¸¤ä¸ªåŠŸèƒ½ï¼šä½¿ç”¨socket.emit()å‘é€å‘½ä»¤ï¼Œsocket.on()æ¥æ”¶æ•°æ® 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051import React, { useState, useEffect, useRef } from 'react';import io from 'socket.io-client';const socket = io(window._CONFIG[\"socketUrl\"]);const Home = () =&gt; { const [userInfo, setUserInfo] = useState({city:'',ip:''}) const [inputVal, setInputVal] = useState('') //inputè¾“å…¥å€¼ const [msgList, setMsgList ] = useState([]) //æ¶ˆæ¯åˆ—è¡¨ useEffect(() =&gt; { // console.log(inputRef.current); socket.on('info', (data) =&gt; { //å•æ¡ä¿¡æ¯äº‹ä»¶ setMsgList([...msgList,data]) }); socket.on('response_msg', (data) =&gt; { //å†å²ä¿¡æ¯äº‹ä»¶ setMsgList([...data]) }); }, [msgList]); // è·å–å†å²æ¶ˆæ¯ const getHistoryMsg = () =&gt; { socket.emit('getHistory', 'ç‚¹å‡»è·å–å†å²è®°å½•') } // æäº¤æ¶ˆæ¯ const submit = useThrottle(() =&gt; { const newVal = inputVal.trim() if(!newVal){ return message.info('æ¶ˆæ¯ä¸å¯ä¸ºç©º') } let params = { id:new Date().getTime(), date: new Date().toLocaleDateString() + ' ' + new Date().toLocaleTimeString(), message: inputVal, } socket.emit('submit', params) },1000) // é”®ç›˜äº‹ä»¶ const inputKeyDown = (e) =&gt; { // å½“æŒ‰ä¸‹å›è½¦é”® if(e.keyCode === 13){ e.preventDefault(); submit() } }};export default Home; åå°ä¸»è¦ä»£ç åå°å½“å®¢æˆ·ç«¯è¿æ¥æˆåŠŸåï¼Œå¯¹ä¸¤ä¸ªäº‹ä»¶è¿›è¡Œç›‘å¬ï¼Œå¹¶ä½œå‡ºç›¸åº”æ“ä½œã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940const app = require('express')();const http = require('http').Server(app);//è¿™é‡Œå¿…é¡»ç»‘å®šåœ¨httpå®ä¾‹ä¸Šè€Œä¸æ˜¯appä¸Šconst io = require('socket.io')(http, { cors: true }); //1.è§£å†³è·¨åŸŸconst mysql = require('mysql');const db = mysql.createPool({ host : 'localhost', user : 'root', password : '123456', database : 'demo'});io.on('connection', function (socket) { // å½“å®¢æˆ·ç«¯æäº¤æ¶ˆæ¯ socket.on('submit', function (data){ // å°†æ”¶åˆ°çš„æ¶ˆæ¯å‘ç»™å®¢æˆ·ç«¯ io.emit('info', data) // å°†æ”¶åˆ°çš„æ¶ˆæ¯æ’å…¥æ•°æ®åº“ const { date, message } = data db.query('INSERT INTO chats (date, message) VALUES (?, ?)',[date, message], (err, res) =&gt; { if (err) throw err; console.log('æ•°æ®æ’å…¥æˆåŠŸï¼'); }) }); // å½“å®¢æˆ·ç«¯è¯·æ±‚å†å²æ¶ˆæ¯ socket.on('getHistory', function (data){ db.query('SELECT * FROM chats', function (error, results, fields) { if (error) throw error; let result = JSON.parse(JSON.stringify(results)) // å°†æŸ¥è¯¢åˆ°çš„æ¶ˆæ¯å‘é€ç»™å®¢æˆ·ç«¯ socket.emit('response_msg',result) }); })});http.listen(9000, () =&gt; { console.log('ç›‘å¬ç«¯å£:9000');}); å®¢æˆ·ç«¯å’Œåç«¯ä¾èµ–ä¸åŒå®¢æˆ·ç«¯ä½¿ç”¨çš„æ˜¯socket.io-clientï¼Œè€Œåå°ä½¿ç”¨çš„æ˜¯socket.io 12npm install socket.io-client //å‰å°ä¾èµ–npm install socket.io //åå°ä¾èµ– åŒæ­¥åœ¨çº¿äººæ•°åŠŸèƒ½ä»£ç åŒæ­¥åœ¨çº¿äººæ•°ä¸»è¦çš„å®ç°æ€è·¯æ˜¯ï¼Œåå°å£°æ˜ä¸€ä¸ªå˜é‡numï¼Œå½“è¿æ¥æˆåŠŸæ—¶+1ï¼Œæ–­å¼€è¿æ¥æ—¶-1ï¼Œå¹¶å°†å˜é‡å‘é€ç»™å®¢æˆ·ç«¯ 1234567891011121314let num = 0io.on('connection', function (socket) { num++ console.log('å·²è¿æ¥'); io.emit('num_change', num) // è¿æ¥å·²æ–­å¼€ socket.on('disconnect', () =&gt; { num-- io.emit('num_change', num) console.log('è¿æ¥å·²æ–­å¼€...') });}); å®˜æ–¹æ–‡æ¡£ä¸­æ˜¯æœ‰socket.on(â€˜disconnectâ€™, () =&gt; {})äº‹ä»¶ç›‘å¬çš„ï¼Œä½†æ˜¯æˆ‘è¿™é‡Œä½¿ç”¨å§‹ç»ˆä¸ç”Ÿæ•ˆã€‚ è·å–ç”¨æˆ·ipå±åœ°åŠŸèƒ½ä»£ç ä¸»è¦ä½¿ç”¨http://pv.sohu.com/cityjson?ie=utf-8 è¿™ä¸ªapi 1234567891011121314151617181920212223// é¦–å…ˆåœ¨proxyä¸­é…ç½®ä»£ç†'/apiSohu': { target: 'http://pv.sohu.com', // localhost=&gt;target changeOrigin: true, pathRewrite: { '^/apiSohu/': '/' }}// å…¶æ¬¡ä½¿ç”¨axiosè¿›è¡Œè¯·æ±‚userCity: `${apiSohu}/cityjson?ie=utf-8`async getUserInfo(data){ const response = await this.$http({ url : userCity, method: \"get\", data, }) return this.$handleResponse(response)}useEffect(() =&gt; { getUserInfo()},[]) æ¶ˆæ¯é¢œè‰²åŠŸèƒ½ä»£ç å–è‰²å™¨åŠŸèƒ½ç›¸å¯¹åå°æ¯”è¾ƒç®€å•ï¼Œåªæ˜¯å¢åŠ äº†ä¸€ä¸ªcolorå­—æ®µè€Œå·²ã€‚é‡ç‚¹åœ¨äºHTML5è‡ªå¸¦å–è‰²å™¨ï¼Œä¹‹å‰ç¡®å®ä¸æ¸…æ¥šã€‚ 1234567const [color, setColor] = useState('')const colorChange = e =&gt; { setColor(e.target.value)}&lt;input type=\"color\" value={color} onChange={colorChange}/&gt;","categories":[{"name":"my_project","slug":"my-project","permalink":"https://kaisailu-with-ice.gitee.io/blog/categories/my-project/"}],"tags":[{"name":"Socket.IO","slug":"Socket-IO","permalink":"https://kaisailu-with-ice.gitee.io/blog/tags/Socket-IO/"}]},{"title":"åˆ†é¡µä¸Šä¼ ","slug":"åˆ†é¡µä¸Šä¼ ","date":"2022-11-08T06:34:00.384Z","updated":"2022-11-08T08:17:56.038Z","comments":true,"path":"2022/11/08/åˆ†é¡µä¸Šä¼ /","link":"","permalink":"https://kaisailu-with-ice.gitee.io/blog/2022/11/08/%E5%88%86%E9%A1%B5%E4%B8%8A%E4%BC%A0/","excerpt":"","text":"åŠŸèƒ½ç›®çš„ï¼š1.å¯¹æ–‡ä»¶è¿›è¡Œåˆ‡ç‰‡ä¸Šä¼ ï¼Œä½¿å¾—æ¯ä¸ªæ¥å£å“åº”æ—¶é—´ç¼©çŸ­ï¼›2.æ§åˆ¶è¯·æ±‚å¹¶å‘é‡ï¼Œé¿å…è¯·æ±‚è¿‡å¤šå¯¼è‡´é¡µé¢å´©æºƒï¼›3.å½“éƒ¨åˆ†è¯·æ±‚å¤±è´¥ï¼Œå°†å¤±è´¥çš„éƒ¨åˆ†é‡æ–°ä¸Šä¼ ã€‚ ä¸€.åˆ‡ç‰‡ä¸Šä¼ ï¼š1.ä½¿ç”¨FileReaderæ¥å£æä¾›çš„readAsArrayBuffer()è¯»å–fileä¸­çš„å†…å®¹ï¼›2.ä½¿ç”¨SparkMD5å­˜æ”¾è¯»å–å‡ºçš„ArrayBufferå¯¹è±¡ï¼›3.ä½¿ç”¨æ–‡ä»¶fileå¯¹è±¡çš„slice()æ–¹æ³•è¿›è¡Œåˆ‡ç‰‡ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697import React from 'react';import SparkMD5 from 'spark-md5';import axios from 'axios';const Home = () =&gt; { axios.defaults.baseURL = 'http://20.46.4.225:8080/study/common' // è¯·æ±‚åŸºå‡†åœ°å€ const CHUNK_SIZE = 1024 * 10; //10KB const fileChunkList = [] //å­˜æ”¾æ–‡ä»¶åˆ‡ç‰‡ let file = {} //æ–‡ä»¶ let hash = \"\" //æ–‡ä»¶hash const change = e =&gt; { file = e.target.files[0] } const upload = () =&gt; { // 1.è®¡ç®—æ–‡ä»¶hashå€¼ calculateFileHash(file) // 2.å°†æ–‡ä»¶åã€hashã€æ–‡ä»¶å¤§å°è°ƒç”¨æ¥å£ .then(async res =&gt; { hash = res const params = { filename: file.name, hash: res, length: file.size, }; return axios({ method: 'post', url: '/chunk/info', data: params }) }) .then(async res =&gt; { // 3.å°†æ–‡ä»¶åˆ‡ç‰‡ fileChunk(file) // 4.å°†åˆ‡ç‰‡åçš„æ–‡ä»¶éå†ä¸Šä¼  const uploadList = fileChunkList.map( v =&gt; { const formData = new FormData(); formData.append('chunkCount', fileChunkList.length); formData.append('chunkIndex', v.chunkIndex); formData.append('chunkSize', v.chunkSize); formData.append('fileHash', hash); formData.append('path', res.path); formData.append('file', v.chunk); formData.append('everySize', CHUNK_SIZE); return axios({ method: 'post', url: '/chunk/upload', data: formData, headers: { 'Content-Type': 'multipart/form-data' } }) }) await Promise.all(uploadList) console.log('å·²å®Œæˆ'); }) }; const calculateFileHash = (file) =&gt; { return new Promise((resolve, reject) =&gt; { const fileReader = new FileReader(); const spark = new SparkMD5.ArrayBuffer(); fileReader.readAsArrayBuffer(file); fileReader.onload = (e) =&gt; { spark.append(e.target.result); resolve(spark.end()); }; }); }; const fileChunk = (file) =&gt; { let cur = 0; let index = 1; while (cur &lt; file.size) { fileChunkList.push({ chunkIndex: index, chunk: file.slice(cur, cur + CHUNK_SIZE), chunkSize: file.slice(cur, cur + CHUNK_SIZE).size }) cur += CHUNK_SIZE; index++ } } return ( &lt;div className='home-page'&gt; &lt;input type=\"file\" id=\"fileInput\" onChange={change}/&gt; &lt;button id=\"uploadBtn\" onClick={upload}&gt;ä¸Šä¼ &lt;/button&gt; &lt;/div&gt; );};export default Home; äºŒ.æ§åˆ¶å¹¶å‘ï¼šPromise.race()æ–¹æ³•è¿”å›ä¸€ä¸ªpromiseï¼Œå½“æ¥æ”¶çš„æŸä¸ªpromiseçŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼Œæ— è®ºæˆåŠŸæˆ–å¤±è´¥ï¼ŒPromise.race()ä¼šè¿”å›è¿™ä¸ªçŠ¶æ€ã€‚ä½¿ç”¨Promise.race()æ¥æ§åˆ¶å¹¶å‘é‡ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859const upload = () =&gt; { // 1.è®¡ç®—æ–‡ä»¶hashå€¼ calculateFileHash(file) // 2.å°†æ–‡ä»¶åã€hashã€æ–‡ä»¶å¤§å°è°ƒç”¨æ¥å£ .then(async res =&gt; { hash = res const params = { filename: file.name, hash: res, length: file.size, }; return axios({ method: 'post', url: '/chunk/info', data: params }) }) .then(async res =&gt; { // 3.å°†æ–‡ä»¶åˆ‡ç‰‡ fileChunk(file) let pond = []; //å¹¶å‘æ±  let max = 3 //æœ€å¤§å¹¶å‘é‡ // 4.å°†åˆ‡ç‰‡åçš„æ–‡ä»¶éå†ä¸Šä¼  for (let i = 0; i &lt; fileChunkList.length; i++) { let v = fileChunkList[i] const formData = new FormData(); formData.append('chunkCount', fileChunkList.length); formData.append('chunkIndex', v.chunkIndex); formData.append('chunkSize', v.chunkSize); formData.append('fileHash', hash); formData.append('path', res.path); formData.append('file', v.chunk); formData.append('everySize', CHUNK_SIZE); let result = axios({ method: 'post', url: '/chunk/upload', data: formData, headers: { 'Content-Type': 'multipart/form-data' } }) // 5.å°†è¯·æ±‚æ·»åŠ è‡³å¹¶å‘æ± ä¸­ pond.push(result) result.then( res =&gt; { // 6.å½“è¯·æ±‚æˆåŠŸè¿”å›ï¼Œå°†å…¶ä»pondä¸­åˆ é™¤ let index = pond.findIndex( i =&gt; i === result) pond.splice(index, 1) }) // 7.å½“å¹¶å‘å€¼è¾¾åˆ°è®¾å®šå€¼ if(pond.length === max){ //æ¯å½“å¹¶å‘æ± è·‘å®Œä¸€ä¸ªä»»åŠ¡ï¼Œå°±å†å¡å…¥ä¸€ä¸ªä»»åŠ¡ console.log('æ»¡äº†æ»¡äº†'); await Promise.race(pond) } } console.log('å·²å®Œæˆ'); }) }; ä¸‰.æ–­ç‚¹ç»­ä¼ ï¼šä½¿ç”¨catchæ•è·å¤±è´¥çš„è¯·æ±‚ï¼Œåœ¨æ‰€æœ‰è¯·æ±‚å“åº”å®Œæ¯•åï¼Œå°†å¤±è´¥çš„è¯·æ±‚é‡æ–°è¿›è¡Œå¤„ç†ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273const upload = () =&gt; { // 1.è®¡ç®—æ–‡ä»¶hashå€¼ calculateFileHash(file) // 2.å°†æ–‡ä»¶åã€hashã€æ–‡ä»¶å¤§å°è°ƒç”¨æ¥å£ .then(async res =&gt; { hash = res const params = { filename: file.name, hash: res, length: file.size, }; return axios({ method: 'post', url: '/chunk/info', data: params }) }) .then(async res =&gt; { // 3.å°†æ–‡ä»¶åˆ‡ç‰‡ fileChunk(file) let pond = []; //å¹¶å‘æ±  let max = 3 //æœ€å¤§å¹¶å‘é‡ let num = 0 //æˆåŠŸä¸Šä¼ çš„æ•°é‡ let failList = [] //å¤±è´¥çš„åˆ—è¡¨ const uploadChunkList = async (list) =&gt; { // // 4.å°†åˆ‡ç‰‡åçš„æ–‡ä»¶éå† for (let i = 0; i &lt; list.length; i++) { let v = list[i]; const formData = new FormData(); formData.append('chunkCount', list.length); formData.append('chunkIndex', v.chunkIndex); formData.append('chunkSize', v.chunkSize); formData.append('fileHash', hash); formData.append('path', res.path); formData.append('file', v.chunk); formData.append('everySize', CHUNK_SIZE); let result = axios({ method: 'post', url: '/chunk/upload', data: formData, headers: { 'Content-Type': 'multipart/form-data' } }) // 5.å°†è¯·æ±‚æ·»åŠ è‡³å¹¶å‘æ± ä¸­ pond.push(result); result.then((res) =&gt; { // 6.å½“è¯·æ±‚æˆåŠŸè¿”å›ï¼Œå°†å…¶ä»pondä¸­åˆ é™¤ let index = pond.findIndex((i) =&gt; i === result); pond.splice(index, 1); }).catch( () =&gt; { // 7.å¦‚æœè¯·æ±‚å¤±è´¥ï¼Œå°†æ­¤åˆ‡ç‰‡ä¿å­˜ failList.push(v) }).finally(() =&gt; { num++ // 8.å½“æ‰€æœ‰è¯·æ±‚å®Œæˆï¼Œå°†å¤±è´¥çš„åˆ—è¡¨å†æ¬¡è¿›è¡Œå¤„ç† if(num === list.length) {uploadChunkList(failList)} }) // å½“å¹¶å‘å€¼è¾¾åˆ°è®¾å®šå€¼ if (pond.length === max) { //æ¯å½“å¹¶å‘æ± è·‘å®Œä¸€ä¸ªä»»åŠ¡ï¼Œå°±å†å¡å…¥ä¸€ä¸ªä»»åŠ¡ console.log('æ»¡äº†æ»¡äº†'); await Promise.race(pond); } } console.log('å·²å®Œæˆ'); fileChunkList = []; }; uploadChunkList(fileChunkList) }) };","categories":[{"name":"åŸºç¡€ä¸šåŠ¡ - æ–‡ç« åˆ†ç±»","slug":"åŸºç¡€ä¸šåŠ¡-æ–‡ç« åˆ†ç±»","permalink":"https://kaisailu-with-ice.gitee.io/blog/categories/%E5%9F%BA%E7%A1%80%E4%B8%9A%E5%8A%A1-%E6%96%87%E7%AB%A0%E5%88%86%E7%B1%BB/"}],"tags":[{"name":"æ–‡ä»¶ä¸Šä¼ ","slug":"æ–‡ä»¶ä¸Šä¼ ","permalink":"https://kaisailu-with-ice.gitee.io/blog/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"}]},{"title":"Hello World","slug":"hello-world","date":"2022-10-21T03:43:02.633Z","updated":"2022-10-25T03:44:51.746Z","comments":true,"path":"2022/10/21/hello-world/","link":"","permalink":"https://kaisailu-with-ice.gitee.io/blog/2022/10/21/hello-world/","excerpt":"","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new \"My New Post\" More info: Writing Run server1$ hexo server More info: Server Generate static filesğŸ˜„ 1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","categories":[{"name":"xxx - æ–‡ç« åˆ†ç±»","slug":"xxx-æ–‡ç« åˆ†ç±»","permalink":"https://kaisailu-with-ice.gitee.io/blog/categories/xxx-%E6%96%87%E7%AB%A0%E5%88%86%E7%B1%BB/"}],"tags":[{"name":"sss","slug":"sss","permalink":"https://kaisailu-with-ice.gitee.io/blog/tags/sss/"}]},{"title":"Reactä½¿ç”¨less","slug":"first-blog","date":"2022-10-21T03:43:02.631Z","updated":"2022-10-25T06:02:20.386Z","comments":true,"path":"2022/10/21/first-blog/","link":"","permalink":"https://kaisailu-with-ice.gitee.io/blog/2022/10/21/first-blog/","excerpt":"","text":"åœ¨ä½¿ç”¨ create-react-app æ—¶å‘ç°ä¸æ”¯æŒ lessï¼Œéœ€æ›´æ‰‹åŠ¨æ›´æ”¹ã€‚ 1ã€ä¸‹è½½ less less-loader1234// ä½¿ç”¨npm npm install less less-loader -D // ä½¿ç”¨ yarn yarn add less less-loader 2ã€é…ç½® webpack.config.jsåœ¨è¿™é‡Œå¦‚æœé¡¹ç›®ä¸­æ²¡æœ‰ webpack.config.js æ­¤æ–‡ä»¶çš„ï¼Œå¯ä»¥æ‰§è¡Œnpm run ejectï¼Œå¦‚æœæ‰§è¡ŒæŠ¥é”™ï¼Œåˆ™æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ 123git add .git commit -m \"init\"npm run eject åœ¨ webpack.config.js æ–‡ä»¶ä¸­æ˜¯å¯ä»¥çœ‹åˆ°å¯¹ sass çš„é…ç½®çš„ï¼Œåœ¨ sass é…ç½®çš„åé¢å¤åˆ¶ä¸€ä»½ï¼Œæ”¹æˆ less çš„é…ç½®å°±å¯ä»¥äº†ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839// style files regexesconst cssRegex = /\\.css$/;const cssModuleRegex = /\\.module\\.css$/;const sassRegex = /\\.(scss|sass)$/;const sassModuleRegex = /\\.module\\.(scss|sass)$/;//æ–°å»ºlessé…ç½®ï¼šconst lessRegex = /\\.(less|less)$/;const lessModuleRegex = /\\.module\\.(less|less)$/;//åœ¨moduleä¸­æ‰¾åˆ°rulesä¸‹çš„oneOf å¹¶åœ¨sassåæ·»åŠ å¦‚ä¸‹é…ç½®{ test: lessRegex, exclude: lessModuleRegex, use: getStyleLoaders( { importLoaders: 3, sourceMap: isEnvProduction ? shouldUseSourceMap : isEnvDevelopment, }, 'less-loader' ), sideEffects: true,},{ test: lessModuleRegex, use: getStyleLoaders( { importLoaders: 3, sourceMap: isEnvProduction ? shouldUseSourceMap : isEnvDevelopment, modules: { getLocalIdent: getCSSModuleLocalIdent, }, }, 'less-loader' ),} 3ã€é…ç½®åè¿è¡ŒæŠ¥é”™ TypeError:this.getOptions is not a functioné”™è¯¯åŸå› ï¼š8.0+ç‰ˆæœ¬çš„ less-loader çš„é…ç½®æ–¹æ³•å‘ç”Ÿäº†å˜åŒ–ï¼Œå¯¼è‡´æŠ¥é”™è§£å†³æ–¹æ³•ï¼šå®‰è£…ä½ç‰ˆæœ¬çš„ less-loader 1234// ä½¿ç”¨npm npm install less-loader@5.0.0 -D // ä½¿ç”¨ yarn yarn add less-loader@5.0.0 -D","categories":[{"name":"React - æ–‡ç« åˆ†ç±»","slug":"React-æ–‡ç« åˆ†ç±»","permalink":"https://kaisailu-with-ice.gitee.io/blog/categories/React-%E6%96%87%E7%AB%A0%E5%88%86%E7%B1%BB/"}],"tags":[{"name":"less","slug":"less","permalink":"https://kaisailu-with-ice.gitee.io/blog/tags/less/"}]}],"categories":[{"name":"my_project\n- æ–‡ç« åˆ†ç±»","slug":"my-project-æ–‡ç« åˆ†ç±»","permalink":"https://kaisailu-with-ice.gitee.io/blog/categories/my-project-%E6%96%87%E7%AB%A0%E5%88%86%E7%B1%BB/"},{"name":"my_project","slug":"my-project","permalink":"https://kaisailu-with-ice.gitee.io/blog/categories/my-project/"},{"name":"åŸºç¡€ä¸šåŠ¡ - æ–‡ç« åˆ†ç±»","slug":"åŸºç¡€ä¸šåŠ¡-æ–‡ç« åˆ†ç±»","permalink":"https://kaisailu-with-ice.gitee.io/blog/categories/%E5%9F%BA%E7%A1%80%E4%B8%9A%E5%8A%A1-%E6%96%87%E7%AB%A0%E5%88%86%E7%B1%BB/"},{"name":"xxx - æ–‡ç« åˆ†ç±»","slug":"xxx-æ–‡ç« åˆ†ç±»","permalink":"https://kaisailu-with-ice.gitee.io/blog/categories/xxx-%E6%96%87%E7%AB%A0%E5%88%86%E7%B1%BB/"},{"name":"React - æ–‡ç« åˆ†ç±»","slug":"React-æ–‡ç« åˆ†ç±»","permalink":"https://kaisailu-with-ice.gitee.io/blog/categories/React-%E6%96%87%E7%AB%A0%E5%88%86%E7%B1%BB/"}],"tags":[{"name":"JavaScript","slug":"JavaScript","permalink":"https://kaisailu-with-ice.gitee.io/blog/tags/JavaScript/"},{"name":"Socket.IO","slug":"Socket-IO","permalink":"https://kaisailu-with-ice.gitee.io/blog/tags/Socket-IO/"},{"name":"æ–‡ä»¶ä¸Šä¼ ","slug":"æ–‡ä»¶ä¸Šä¼ ","permalink":"https://kaisailu-with-ice.gitee.io/blog/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"},{"name":"sss","slug":"sss","permalink":"https://kaisailu-with-ice.gitee.io/blog/tags/sss/"},{"name":"less","slug":"less","permalink":"https://kaisailu-with-ice.gitee.io/blog/tags/less/"}]}